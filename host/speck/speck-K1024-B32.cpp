#include <iostream>
#include "../../src/e3extensions/secureint.h"

using namespace std;

string libgDir = "./libg.so";
string gFunctionName = "libg";

// #define EDS Secure::size()

#define ROUNDS 11  // 22
#define KEY_LEN 4

SecureInt *pE0, *pE1, *pE2, *pE7, *pEEDS;

//#define ROR(x, r) ((x >> r) | (x << ((sizeof(uint16_t) * 8) - r)))
//#define ROL(x, r) ((x << r) | (x >> ((sizeof(uint16_t) * 8) - r)))
#define ROR(x, r) ((x >> r) | (x << (*pEEDS - r)))
#define ROL(x, r) ((x << r) | (x >> (*pEEDS - r)))
#define R(x, y, k) (x = ROR(x, *pE7), x += y, x ^= k, y = ROL(y, *pE2), y ^= x)

void speck_expand(SecureInt K[KEY_LEN], SecureInt S[ROUNDS])
{
	SecureInt b = K[0];
	SecureInt a[KEY_LEN - 1];

	for (int i = 0; i < KEY_LEN - 1 ; i++)
	{
		a[i] = K[i + 1];
	}

	S[0] = b;
	SecureInt ei = *pE0;
	for (int i = 0; i < ROUNDS - 1; i++, ei+=*pE1)
	{
		cout<<' '<<i<<std::flush;
		R(a[i % (KEY_LEN - 1)], b, ei);
		S[i + 1] = b;
	}
	cout << std::endl;
}

int main(void)
{
	Cryptosystem cs("97317394065852698063612917201102147847199111467849349891621340440499946350686926592320675972897920430296425273464273322187040310710600940153410904291155210658376500326035767890342890880317015061565425089257125506939202530973971663467036812723596732144592469705805782123212791788237789983423737946480786674597",32,{"1230690952468065982115038611119747005614081628364725964302709692812182983887015053600978494472829142450250107924609612933431383625894446853157505525077284605002151728086842529658137872698195972466552160496902452716366281225811300942778100046911737316889674528238535288907745163648109233886059379134328014451704915433385689900706125747535711704186968281795979509337559815059009796088278912277697538236928917896930034479614014655025084838773547534399248570418536485511548366894453277510264837004358523367850834846315598187231270515295423527531485206083120656668279124386625246355217121175651740390821536969272541310090","6046918330892037321808499205228710492186768662667616728960254643850157962156104512778406190088095482927705828156724651102163546122934673652583081141381744587032396646037517440296979533423818180673831823626368812923390576640052869651546715543118014475553086803233746714495928034533844952830592367846188696637650709919699734606667193009502106112538527755893635346151428400149083802236942764565482919667439466740682365901071752348633501984662772522913870874336991586011380165395176064835155142780938458174666770773309704093267467801386221334061447883415660452874704132281436785520146792655993610273223141439254789453561","5326084146950676001770751425703516223497594259190239362045482028459856137006577005071333504422703311955213364559725831849585700836078989687776388525050689253208506899567913397803309810952751013066661849118859001738104569279943230260498753060169559475763798869926285909337018062987259055974064464692141356246216159795134424643446416296840569947071474467965435775053975610657288669723860747342815884856472568021275636785877095662097257728850175290761693613884832261763042934231984959745026275217637409390302019027280595708797062763891891731194338496299618557264692465374016406945266885934386746521589193088511290873117","5179520962582074188402377369296863915899118121633138811567440143527846273777546780080502045075253779246659382254506908818386307355392361751247960243693224830882061049112135266148453110898248778844559927633345218174923345207405327064257575707588818148793842004001085799760143133375798253384919994310584102037256168075896031289275339970930126540568962548423147532880445368821154930031313510522339628810881097286284642282209009834741147916434430168938611889672448494992314148404694455359688655070743404166021714913378289461898353424751052433714109541504055682299848389717482766341674555452655429284321470954802159509151","8797256114678015043625994360301533623863872929847012956497193863245987399729015734771987318895680229733397920712083957090408312495214080469039266665326724636111210200917684360985612629640254965316064654747616317424071288075649790158299724688111351147091013230113968309004042218120701952110810573404464690008423362881440920121790441623165292444618247088737894291458500408562914050939497791803704216346869303018434821150054228904065427590211816608040064025905303899874962503750001208191536594443198350305706434023713802047366795555102322764954688333221554214137900168307750325608169979530571550080034464454406255887210","2075761027030141672790178286854249363573378970993327050808499990486336519511583207787561929682180016202859607150806547593367619570190947289206387357094924477142235211917789813963988338939290762980652560559637933008532333864021400559432308936899589222903080519662802873724111181266165892985166590821142631095746798575443524336301362317824171235154949074091261719588691711987819694158287284792493583566920637320669499069835883269695754313427783522517640737450993768019653098082126454218015905740147314380639374525252150040013352716456023953365091302312567180395212745721268092157115585799470866496138095450080451002213","6783841081639604342843456652788666622996701528087612676042990281367540929343203480807721266994401726301923040510511262193799849450959525298069720263351406827240471342730259633112178215014428318786986934114923124953251153538935012987232840674385217127247874214386044680876340230301500537137942002939949248132672190866963101252747166012950058403251094011024816205542323218964231233697594292956984315547759313814451232351893525405628188035865646840236358767373636271743492607918399866997395503072857053690901238261200413670696030208627017373926914150693901366634710214656199178132082622341299966202931090368186899118932","563517265462187314895258346592497056702599621994083046087081298108605562030704551508075025337748485675494298610633071131606657432307391685764770328806588696097969775500313402748493982048155614334534613417276929783106240468393616921079238608904124997080112055318435315276721615292311964188394842382615570014095976880590765186976656185524086876074056113674073362737355052046037773203361116540904395278473449780360879219613846372503932632215263791677557452518680378857906406078670828127281744466719321673008321030299822013416086570082075729385722399234140671286325298807131670712492716335767357252678773329030197045116","6375759999967095387682209266075805858150850744006168968496589298679503346838931025436141073953859675250208418480018512434529024520248998716474510750965857356112576958110737757659668306396214883793661336413053776680198754427554009742471771099146510957612689168133493767520335463288149639850238328858517855760670009499233481988432399572299391761409713880784106287117273269496944826016227460589429827644188955512378277369131543903371791062427300325608893885665574724035416964779223982977543256882296114053440267480293286144356682262411531094795155541648563920056924449651218797991892637169768689515279500973552090547975","7740222076472341313688527843742393429702017584194761535604980538726441083051073370534139784150948933614527596545136772663150076222806281029011101171287965697883010846453477915514257494082577075860934612681268674192409868300815054786973889639217039568127379388197237016192404615967634702865034338219551427857427429740857535342671467180259291117812327862599665983519343880406075259058469227831207696007723617657085682397877046051503049464941908003707086707908100731006122307958137129995427916322364514253256062624721034714066305484192921271199374679035275452378796696797510817986244637271199411657711606757715632033650","126324152093402224405585260921434274995843291118149561787397693836422202620858472775110166836728951914438048556956092762725858250583977068819888370582649181271775309602472186730824369415838096314304396746686492669067843805705996519284252789194921840302030117715931832826688829027249865365888058163709253574324808896172768986339413416643849221203335693473576025070527231031135816506553004580117703689351574726756056361813058081053649235538110135504727365781016628141468215211652472602124191671308739958548588931511115320719446082381586689322455465608721095650011930490749586742810031395673508412538164909274018236535","7670496376713873486881466022666237031647956371116984890972531507616674562485659152386180105928497630718603262580104528669121390513281566445416607085192101231126606412459825906199707478302416587684711052943484978634270972353716641801986669560326504496336341581438950949818873952300379273533977131223825075501426783244456299672553930124911148852550621259702069342227919379746641233461398432055744126426966770798883877667128974923153421015177143223271614312712437380951018516186962241136201296688789984693658294455215678885684463362145227406550180093062910536757654390766804823806730129091526400967648682449911087018159","7806653561503251834490289277830104546445673027766643906528110909863143590169660709032240363696561404731574509084214944703625336506136697366033962810006111039763332178880386616733862059532054104412612934098437142491338693022514885501619210370459694294512570707081041648699462380470904138020668297609931028997457224670425326410651614378216151346485191991258535786642241596919369120234370044175163127791355553981985061396324920949232690547394554435648708186232202465899142967704415819701019509366451884898883940355785152305434919814932475870214604982284115754585941930486817378281108772958369888593832104398077636215207","5904709013888031404906396812759302596572557500560871542238035731303221050701934805298116733457907637690562768551371314942660466370699482340117732210933589026346938637143708613795614988404370714998397252552890675101855646329840714754664611187908343603618439731340843031609885983783794695551788559044922992576961278271993407223022082689094463689101898869644797949163921716239488557600136003058101094469066590028202414874975277257039011106852546321945496778111205518967709012180852724706312185491237122102379996249546785301652306368977332490374783341397699441067505322401461733715653879157186253783462803592168728239513","8921120199944968724185810929491315190711526018893174061619493312130945968988500733343090178734651392770899617471221134617266448517869983958761407486328946024205072669981963618132486476553628654359267919079213049610905799068304550649291414128540322719897419441426349557994138158406809041426832340633338195325205435518047891610792306531374995281817787298186819867898335467076218102277966390752194607681846699456316339931697713449593614822834803258614627919685085254119411969355158082072569609146806250936832873673937384294545978470103201223185138304192661270606805027618941414688773673940965628886697314674974266544379","6873945906986702484053954110266205025935054598204211785812856676614246125735353022294190401995500456585603206346278362538058526612876670953276985558185183965146069522037536820266232721780665729847753404508675703176013578383417525544316817016523454542987957081689212714754176026714194219978826689744623582383493571779384913952548615075118094563870408106440338281119496433841761833684997052544050547527417247554128492402135708753496657714337145872821615125861854358846030451982551252107953535539303163371482129764287593126821927873482924784290402799310661174469869480419194748648693355217086432470715283916284708238336","8368650560464183119136311639534921452386927630982456199750234779371414318659949119211771246022947529448987705736143075467692296397492482637421439973718559440562438023807495919053122788209812196993716408917910619919482564637674458079130835423590633620853432870876788096636198787695582605303216363829152213870307185269065238439962518655745798596621861279135921424898212040746206878151242968006470747454212956291647880621491946171140317128837403654128796644665158143854403904690963743662494796940228660713872507747428832770203552903674461637605601963808045069257942445923533789237175559211263248616673205955418913302838","3848224829132420180350924887450438253053024994849846137147926422098878017665428044742408745804202148242649120570835217390759989160956115573334226210192724891164347752790751358817403837469915880197740062645673856508301727154917076290379383072070726735706489768652960411842711645775383417692285017661190212523908445074896554144050890489380081683416523614731180939443052301511864179262020006649698869386960474416583819241150257768368166202984757521314377565680093285192096268454113587680954430927490562633665502841981411391240975620070723473291074476998897303986879707407628674497750037835252573462442813481022606082371","1535989877089795144798014485257332291081638517084767572172586374190148837714994811118152515807777000465014560593341004336240998203074632130167783605882008865114096786726128343365249537949094087725456892854919609579846203597797598686545931208846581661409407616721722031001845952196700934291232624964424801717065805777685786743573862813357798273494796161729358116630632459389511234433033593386698650422616149451010852801801244060747557053318642751523556615841237575727995800953354549783019282735028115064630697325397677321370004837925647395927746090886324878010185344428484455192426819164388086161506134091210254412046","1013931276836171845708593060635239307649475612102266826130330422874267800585068258522843463858328040742290561785623604654279883683640500849650990487117958857009146549650827194244611546114445165940582594272456243957776649641229672501063195045302922239826874924468579211115860749261679349495091491164725384234605762368866838962361594873980982492037308603613386998555947895969357073591193161550103088923807507380544860505402996596220224990252491522195232576392353799964492009993291401622291864672494130556212404526967992444431856520823360798227072623189501198220495407701423729101226271650714935397063708190638253374090","6917338289501642447802188544144827939629145114208992163717922202400560752915002222615549498245679502412567635196340146763472465274312571059732191245388907291310844480135441252200705094182472310021062602790604038751430366094254903382823841581710122320067403919646922776658943954546697329634591406788196650733739526683555100850588810299241868582099841186759924951987282138916193745059122569270777585979986950652809524136487285943708533221757452236055230953254468948594102162433818416578136272867136582626614826243257466539045473307240497250425714521487765239117107392898197180917568156204680603815908686694792260176387","1550526762349771884334060661055066910188905797180700139031934160872217768819889413537868606610377800419173307902252812580825553480051144728960406220050030079897386902811791606246561065911979802885237805416055930451013091916700604401849478602900751000049445114858834085950730643818504604955303142107286169792980214812329512797088651520318808698598436253683647972553005194831290699342594252123402205347487403886853950501663066700755460971440648328384834906020117779285723602495310265046129277498326663161622478069940038523389474793636942522515249645225680364168417001925958577134497279517242427863946067367601413577594","4616492560103459875127893362332026517800312800284858360153002122280788146388391440707566268527580678698022303453293051805262462236075474251304045917105093325779656618594746661163093990624203371391270923728044749766181776569974136659501769688365868219729159773104605589125929699900060024502600950983617999396648047901605946668527750940449174298297938813235101014408937912330883523886368235189513338224628919220492872206237449873092203767997544846632413720027001364846544656984004261892818236701049032899184145961314196763708262853945229730164423312075379814711126815172447023970526153805115107904691926234098457990154","1122000083325390646610094676971462259273036965504123956607388431624560625913001703653049779399722013677207101121442576318165953796093246837161033651808993016270781719792417591099816938722014914617152299178508591830986579682947075969799442886446242799704466561607757534167759508027917965718064271754543500208415711503687560472597550336277324064431453267316174567057402925912955085561059713112264845814263927404160629281201244928539888794719602202064284126029446575230924857650045269957811001010189339972231404385736703161708861090509951110086120782639622115053492253627785611965230531225608650040265915740866350630221","237448954677938445859978842144870946290385073366226173879484887003048803424263297326411683322323792497776906439649722026400853419227644308801299324723989224165779395465237634537575887786756136758965001474347003887514663215198932159819802646631730640826859937681251535223232959143436552124872167753603041356160857983002857327380902684012870353805524177251396293598568674335843018081971034990547830417576266754577938503272776793163348650768179059233510827213318589670449978168918189482778386143883777519434366918435332054494583475417816565257057643024911086273788166527790799023340665092534899668955148032428190808054","5246559068452468025921692981223974021648468355781362472932473097147858820312202874096985851571241686077842985520346185571967388943731013185378582326987586413513355130104823780522142402134980930186149274560532858427775169172936775732429720648868062025006892737624948067425851456289788782767861652428994290942971219155749349021324795830202679393562898088258889899088869799012595485541820883907843524611170945466800499623957160191677416591877367271057416295666551396041161915828583428598597707960820985723919956879440279680510776941258448268659550188404073130762305984942899119511819072646239595920843927840250053867702","7961805931471436092854225891754959680275041569188641085612875450942180507264852401122476465787480381648184842171271037048257087942549285900798936290289015518184711494638575208435284903019583759214732608394846515438905127663981655378525893804680069018677002233767357926665907312288373437732382487093792019110923286030142935123576148661716890551029874453299550461037962959845620324450116709850699426190075963027923568856454267010364786813954453572423769587184847836180566817414378105617089500168111499904109212571443349483408612337614962237520241805917859874103961719542957322501271950747686256201627927054378420780534","4303506017896069805812767373752700269017156700828326273170985980895984469523963806156619389835207120127686113385514284239105418549221604924195892158786808300726485198737993992195965533710870899137272527496290511425408798513084967169366747024684272705515811201799201872769562505029602338743260118106558945816170226452168970050315641381947279515634075673527741302079449781771441334832772867673573668013264956242724672077170357351808563280897270700327508191635799600247986249538944418469466654465937135066752596146520606563685140500785714045314348154930164904266497865257454309719617769650281608298119747805962879488214","8442853898717384231722018064492999399572815097938790905511550380235929211064730218940708068890324984322850298144768080406555424604780555143482343974424837049405720191032510578175820637969134071948505354898852580169824672126912913272383908142923974831586794534859739920285877976828826183205845691318171636399374929451147634092187750707754358232665177196282058325981056279921636881799086077138624767302113056535699427318526302710903930045621522700173418923169940383259592405866945498573140176372211959980832521145528207581247080413698507770762307721017497010623417167260882981050542315811022328477374636462440485670406","8898457954021726546893591667475845458269920573288571571514111092598081320815942275718770840084637553821552597777856558172326655877545666535734675150156457195451957538034582021475702644019401235616798484135066105504176853968850672657202403589265304240474420114515915968672732681114894318126643119874781759490688313412519944527192544202705705423099936740022404369101024241125139283931642457799445589668115720472001646558667051421669957346321050747823039814922131658154040061420029021211195471197197714476508778450083312709287581285090784361027195498335658454087887454401900881997243538508169586765451920200100676178119","8679624272655176706859094425601121442274551463326246591465688975609891594384046697009261563607316778112937763141398851065659605698908699526498341622703292198157987624498160088136187072082033719394286638817343522753440653429911135460260974106729489060907455137878463608088281697550566339034085810632727383333523789716584447255815560995507214367156158964165387790298661996516461173528942372920386223408942525308139174174230682751827810707875017887574087626629254415211587559173429900430110740627794260473023163406499166111976294205481653955028263434748815976365267184626010813075503454177737326146233851170485413964948","5678648965966885284277914015445003582857846629324705411233231804262017222742378101344107414901333187303768645224131553446820869658706567046083913174495945084333052609771328983522474553453765457852498011743642002422032020819013222939617934710981139147016978559213994202098201853526122494892282527937320573303528683759033455645861027180213273037101932932179670511965639750854581498617144034650255131103485425642601565331569677987959041306424747854618644702784660091336253553999299695201030223117148336626318258288119788177974934705281434048378163210472773338664931248147917272608717138410398678046240260487818321318006","1016016741509312648381024930861778637957061152725937516342879701641899212735655541610627207248602358950662863740180710380964485639123609572253281818304144743075205315039098548587714792247510662526351326947988066870648245339546337462744221666677957611739889911734787379010038620110420751877028629996611773836580870085782771547102478311640109739296703368665522206916810558277928749890977461560716979181911063891677466139525462312965320006453613148938116906131500320572611915845754900360757465371088700271578152548031839844034128300980329846989070154405051292163576520068589049966684673498963122927385862028396061961824"}, libgDir, gFunctionName);
	SecureInt E0 = SecureInt("4736380497598139338579754362294881122993178634839431438851178261088763293760411172597020365179133055935945180446449066298230243708933752847872466713407627647640964139260313231000404535271965160205063781988297301366077364790283688337197230711343538359300353535145742296229322676485517353420062036567867753045014692114328016688103648221249558520112113486208043710678779394395752567891150079352388264206080095750231366293893392645998414939998668773382967161696393560791180649497467378636792233527113716960273362423122019105859368628270230325715277619305595853393947857695657107978492426276244245759071709602990403208718",cs);
	SecureInt E1 = SecureInt("6090304617642776925148909761338049990523841931421713267440759203952750183102897247244024910030419625308288765128560167508839313877585888103316294311135037463502988280889525309624979826255934673028409316170012684264444373996963609143067290124561942633540205353112186942362457790102173190607033451388234087881287599363870147293749626180263941105078118424424716737049075448667652152924341875062668373798369393699086848285185041227924816334933749121699474747545323685121896997881422659827404967043967590320318374166295670014472494822537128839742281824161185888033268948499007966109403708467850070300055496285635401356546",cs);
	SecureInt E2 = SecureInt("5031468348319168536523224000858850565795216918761931127991041319383639820098268591520002068225477534151788116575038654348397651304343154827110602798035631752051598406527883433572677329361363879606263085897732625380676612529631251083070205904069741145936881313572410455644268663367558135026347547800565303725348808448943526514548590233329806545272699655855216123490447593065294817748278778296998020073300398290019094000774801479192155981799911833285936153481818837658386021564499119377719806030112045004816119324404781686458993820881299468115614974451416435507118641095446283371454032612113504496793184834892057930790",cs);
	SecureInt E7 = SecureInt("3102495952266706940302326864690694165381013267168466984443050615622159995295150380572227768463944250211310095813681012103585976008949986993041532596175052161388341867446923738082126848802486261906310183901012414157101149472479041889520536781813585731933285700934728706170063242200779719362997333866214529530152896752419991776055634829625129960391422374705190633348989826824180501017962174600253182950912395967673030207570614469490150852736275362157191229834888369420125185578626118676433489032492307040044558068562761668191856551280796732637746112390333841551932792153326624939671594511516332153747386652616568361263",cs);
	SecureInt EEDS = SecureInt("5859117353851936666489251553203668624914542617417534178296556841036141871550153618877131582391765803283925774505099627696962622925908450048064805184589147633782002892146222277516617388064501837084804518432757000450613607056496438604120671355655070258643356953630764896518016199165842255470967227897388492436175201995847563133052693432851938974854095668700344163362374522128161832518926849233797489021728777663514786165440317587013862488671237740857555927082603245111423248191157491296866154973826754516741425761086105019219930222639433152218393865813446124670725015729415352409843714473207688571031142250791013000294",cs);
	pE0=&E0; pE1=&E1; pE2=&E2; pE7=&E7; pEEDS=&EEDS;

	SecureInt key[KEY_LEN], exp[ROUNDS];
	key[0] = SecureInt("3958706149057495786571503464060088370956835423299721666870198339501687698610749584528576224855838682645659328490363006727338101546514114404508736078766558764368356032393714710688828136507928883579544157931639387184416433999160507411730905552768282192689866331341386033332351433071643569360016224142228035541673720693976714894897235416034880710425453040053850789907996226905258313527303033243678412232506126862145331613751965840855682487370352193313689577086338922018676465582463924296594444948502492072288126852896166094529271656770008843867325188182265289968761090247232338416143686338794755419949609569751024685769",cs);
	key[1] = SecureInt("7449971955023956312807026464033335500367717048503981075901508624077262740662501582111012438296752000423221858076403211661842729599297991507388485630875744624307025915536760819574893797532403301492887819353923402275320495871831448146289984514328199871644588148094600674180959831537461776865674306342600125382319597201901237073961939126081098174820354656911679825497329428248755392318562093722951975823453615863778514302688143094503302134980580210414623454595473421723922567337248619696053686459807626255841729137893702185845992989922373377101171742594044441590964436239560856407235319181871679473418438870663755930011",cs);
	key[2] = SecureInt("6882708146536618611743552249995586015765061325781750439495498458089671185308074871296768080270429852413696229881957492088659197071311731354747739214771178253449035753516061601949670037667733497508167935043883190071780471431964107498614323523574170158694903532750592144301483623568733146724890173009117935658355600848804375376406994027955836922414561601386709014383449414199490694332016635907531069997482789612447814389992959678997206908304744717724416026521618037380484607392120405391028976422572327991989120113863424473896214002026292487493003209611098360813924859376289485089274627983661968311843200227367011308504",cs);
	key[3] = SecureInt("3773470086989784947192981911913485206750292928167119876675299389030748093174378449493010635801315004042335720933750307240815931879228471261923633077523587910649801356240824059373283750415916079108926348272160621338838220718997640381037119026758259757377710985483959470484641999902524196766337373009879567408527709975164470162336924766562088518052185633751545960544309085444923330719229027866623912453876552469110626327460472627064797287374655004529479899427089277896275014461207501415641728320903534397597683048110799793585046126815522548714713958187043336617122296078794149682383816557590020304624808537131539891020",cs);

	speck_expand(key, exp);

	for (int i = 0; i < ROUNDS; ++i)
		cout << exp[i].str() << '\n';
	return EXIT_SUCCESS;
}
